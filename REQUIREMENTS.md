# 要求
GitHubにあるドキュメント構築サイトリポジトリ内の英語文書（原文のサイト）を、LLMで日本語に翻訳し、日本語サイトに反映のためのPull Requietを送る、「AI翻訳スクリプト（以下スクリプト）」を作成する。

## スクリプトの使用方法
### 前提
翻訳対象の原文サイトと日本語サイトは、それぞれ別のGitHubリポジトリに置かれている。
例：JHispterサイトのドキュメントの場合：
- 原文サイト： jhipster/jhipster.github.io （upstream）
    - upstream/main に日々英語の原文、主にMarkdownで書かれたファイルの更新がコミットされている。
- 日本語サイト： jhipster.github.io-jp （origin）
    - ここに翻訳のPRを送るとマージにより翻訳が反映される

### 使用方法
日本語サイトの GitHub Actionsにて一定期間ごとに発動するジョブを作成し、スクリプトを動作させる。
ジョブの作業内容：
- スクリプトが置かれているリポジトリをcloneして取得する
- その後、スクリプトにupsteramとoriginを与えて実行する
- 翻訳処理が実施され、翻訳結果があるブランチとPRがoriginに送られる
- orignで人間が翻訳チェックし、origin/mainにマージする

## スクリプトの翻訳処理内容
### 概要
- originに翻訳ブランチを作成
- upstreamのコミットされた内容のうち、originで未翻訳のものを抽出
- 翻訳して、originの翻訳ブランチにコミット
- すべて翻訳したらPRを作成。PR本文には、翻訳ブランチの更新ファイル名を全て記載する。その差異、更新状態がわかるようにする。

### 重要な翻訳処理の条件
- upstreamとoriginのファイルやディレクトリ構成は完全に一致させる
- upstreamとoriginのドキュメントファイルの行数は完全に一致させる
    - 改行の位置を完全に一致させる。例えば、upstreamのファイルの10行目の原文は、origin側のファイルでも10行目の翻訳として反映する
    - もし翻訳前にupstreamとoriginの行数の差があれば、行数の補正をしてから翻訳を行うこと
- upstreamの更新内容により、翻訳方針を分ける
    - 更新内容が文書ファイル(拡張子がmd, mdx, txt, html)かどうかを判定する。文書ファイルでなければ翻訳しない。
    - 文書ファイルが追加されている場合、内容をすべて日本語に変更（翻訳ファイル）
    - 過去に翻訳済みの翻訳ファイル対し、さらに原文が更新された場合：
        - 翻訳済みをそのまま残し、新たに翻訳された内容を追加する。
        - もしくは、翻訳済みの箇所と新たに翻訳された箇所が重なる場合、両方を考慮し翻訳し直す。
        - 原文が、誤字脱字など原文の意味が変わらない変更の場合は、翻訳対象としない。
- 一行単位の翻訳はしない
    - 行数一致を重視するために採用しがちだが、全体の文意の読み取りが大事

## Pull Requestのdescription
人間が翻訳のチェックをするため、descriptionの中で、以下のリンクを並べ、チェックしやすくする
- 原文ドキュメントの変更コミット
- 翻訳ドキュメントのコミット

## 環境
- スクリプトは、Javaの最新バージョンを用いること
- LLMフレームワークは、LangChain4jのv1.5.0以上を用いること
- https://docs.langchain4j.dev/tutorials/agents に従い、Agentic な設計方針とすること
- LLMは、Geminiを用いること。APIキーは持っているが、安全のためGitHub Actions の Secrets に登録する。
- ローカル環境は以下を考慮する
    - GitHub Actions を何回も実行しなくても良いように、可能な限りローカルで動作を確認できる環境を構築する
        - GitHub Actions の yamlに多くを書くのではなく、要望に「ローカル環境でスクリプト実行も実現可能とする」と書いたようにスクリプトで記述するのが望ましい
        - 一つのスクリプトに全ての処理を書くのではなく、役割ごとに複数のスクリプトに分け、動作確認を行いやすくする。

### 開発モードの翻訳処理
ローカルでの単体の動作を行えるようにする。
- 翻訳処理を1件や数件で動作確認できるようにする。upstreamの更新のうち、指定したコミットハッシュ以前の未翻訳を対象として翻訳する。
