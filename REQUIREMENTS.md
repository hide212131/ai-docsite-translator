# 要求
GitHubにあるドキュメント構築サイトリポジトリ内の英語文書（原文のサイト）を、LLMで日本語に翻訳し、日本語サイトに反映のためのPull Requietを送る、「AI翻訳スクリプト（以下スクリプト）」を作成する。

## スクリプトの使用方法
### 前提
翻訳対象の原文サイトと日本語サイトは、それぞれ別のGitHubリポジトリに置かれている。
例：JHispterサイトのドキュメントの場合：
- 原文サイト： jhipster/jhipster.github.io （upstream）
    - upstream/main に日々英語の原文、主にMarkdownで書かれたファイルの更新がコミットされている。
- 日本語サイト： jhipster.github.io-jp （origin）
    - ここに翻訳のPRを送るとマージにより翻訳が反映される

### 使用方法
日本語サイトの GitHub Actionsにて一定期間ごとに発動するジョブを作成し、スクリプトを動作させる。
ジョブの作業内容：
- スクリプトが置かれているリポジトリをcloneして取得する
- その後、スクリプトにupsteramとoriginを与えて実行する
- 翻訳処理が実施され、翻訳結果があるブランチとPRがoriginに送られる
- orignで人間が翻訳チェックし、origin/mainにマージする

## スクリプトの翻訳処理内容
### 概要
- originに翻訳ブランチを作成
- upstreamのコミットされた内容のうち、originで未翻訳のものを抽出
- 翻訳して、originの翻訳ブランチにコミット
- すべて翻訳したらPRを作成。PR本文には、翻訳ブランチの更新ファイル名を全て記載する。その差異、更新状態がわかるようにする。

### 翻訳フローの詳細
- originに翻訳ブランチを作成： originのmainから'sync-(コミットハッシュ)'（以下syncブランチ）という接頭辞のブランチを作成する。コミットハッシュはupstream/mainの翻訳対象とすべき更新の中で最新のコミットハッシュのshort。
- 翻訳が行われていないコミットを抽出する。後述するGitのマージの履歴から検出する。開発モードはコミットハッシュによる任意の指定も可。
- upstream/mainのマージ: 原文のどのコミットまでが日本語訳して取り込まれたかを明示するために、originのsyncブランチに、upstream/mainのマージを行う。マージはコンフリクトがあっても強制的に行う。
    - この作業により、未翻訳をコミット探すためには、Gitのツリーをたどりマージが行われていないコミットを抽出することで達成できる。
- マージ後のブランチの状態: syncブランチの更新ファイルには、以下のいずれかの更新状態となる。
    - a. 文書ファイルの新規作成: すべて英文で書かれる。翻訳作業は全体に対して行う必要がある。
    - b. 既存文書ファイルの変更：ファイル中に、以下のb-1. b-2.のいずれか、もしくは両方の状態になる。
        - b-1. 英文追加（コンフリクトなし）: 翻訳済みファイルに英文が追加された状態。翻訳作業は追加された部分に対して行う必要がある。
        - b-2. 英文変更（コンフリクトあり）: 翻訳済みファイルの翻訳済み箇所に英文が挿入された状態。過去の英文翻訳と新たな英文の更新がコンフリクトし、マーカーが付いている。翻訳作業はマーカーを削除しつつ元の日本文と変更された英文を考慮し行う必要がある。
    - c. 文書ファイル以外： 設定ファイルなど翻訳の対象外。翻訳せずそのままにする必要がある。
        - 更新内容が文書ファイル(拡張子がmd, mdx, txt, html)かどうかを判定する。文書ファイルでなければ翻訳しない。
- 更新状態に応じて翻訳作業を実施していく

### ファイルの翻訳作業の重要な完了条件
- upstreamとoriginのファイルやディレクトリ構成は完全に一致させる
- upstreamとoriginのドキュメントファイルの行数は完全に一致させる
    - 改行の位置を完全に一致させる。例えば、upstreamのファイルの10行目の原文は、origin側のファイルでも10行目の翻訳として反映する
    - もし翻訳前にupstreamとoriginの行数の差があれば、行数の補正をしてから翻訳を行うこと
- 一行単位の翻訳はしない
    - 行数一致を重視するために採用しがちだが、全体の文意の読み取りが大事

## Pull Requestのdescription
人間が翻訳のチェックをするため、descriptionの中で、以下のリンクを並べ、チェックしやすくする
- 原文ドキュメントの変更コミット
- 翻訳ドキュメントのコミット

## 環境
- スクリプトは、Javaの最新バージョンを用いること
- ビルドは、Gradleの最新バージョンを用いること
- LLMフレームワークは、LangChain4jのv1.5.0以上を用いること
- https://docs.langchain4j.dev/tutorials/agents に従い、Agentic な設計方針とすること
- LLMは、Geminiを用いること。APIキーは持っているが、安全のためGitHub Actions の Secrets に登録する。
- ローカル環境は以下を考慮する
    - GitHub Actions を何回も実行しなくても良いように、可能な限りローカルで動作を確認できる環境を構築する
        - GitHub Actions の yamlに多くを書くのではなく、要望に「ローカル環境でスクリプト実行も実現可能とする」と書いたようにスクリプトで記述するのが望ましい
        - 一つのスクリプトに全ての処理を書くのではなく、役割ごとに複数のスクリプトに分け、動作確認を行いやすくする。

### 開発モードの翻訳処理
ローカルでの単体の動作を行えるようにする。
- 翻訳処理を1件や数件で動作確認できるようにする。upstreamの更新のうち、指定したコミットハッシュ以前の未翻訳を対象として翻訳する。
